
#include "cursor.hpp"

// -- Arrow

uint8_t arrow_data[] = {
    0xFF, 0xE0, 0xFF, 0xF0,
    0xC0, 0x30, 0xC0, 0x30,
    0xC0, 0x70, 0xC0, 0xE0,
    0xC0, 0x70, 0xC0, 0x38,
    0xC4, 0x1C, 0xCE, 0x0C,
    0xFF, 0x0C, 0x7B, 0x8C,
    0x01, 0xFC, 0x00, 0xF8,
    0x00, 0x00, 0x00, 0x00,
};
  
  uint8_t arrow_mask[] = {
    0xFF, 0xE0, 0xFF, 0xF0,
    0xFF, 0xF0, 0xFF, 0xF0,
    0xFF, 0xF0, 0xFF, 0xE0,
    0xFF, 0xF0, 0xFF, 0xF8,
    0xFF, 0xFC, 0xFF, 0xFC,
    0xFF, 0xFC, 0x7B, 0xFC,
    0x01, 0xFC, 0x00, 0xF8,
    0x00, 0x00, 0x00, 0x00,
};

// --- Cross

uint8_t cross_data[] = {
    0x03, 0xC0, 0x07, 0xE0,
    0x06, 0x60, 0x06, 0x60,
    0x06, 0x60, 0x7E, 0x7E,
    0xFE, 0x7F, 0xC0, 0x03,
    0xC0, 0x03, 0xFE, 0x7F,
    0x7E, 0x7E, 0x06, 0x60,
    0x06, 0x60, 0x06, 0x60,
    0x07, 0xE0, 0x03, 0xC0,
};
  
uint8_t cross_mask[] = {
    0x03, 0xC0, 0x07, 0xE0,
    0x07, 0xE0, 0x07, 0xE0,
    0x07, 0xE0, 0x7F, 0xFE,
    0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF,
    0x7F, 0xFE, 0x07, 0xE0,
    0x07, 0xE0, 0x07, 0xE0,
    0x07, 0xE0, 0x03, 0xC0,
};

// --- Grab

uint8_t grab_data[] = {
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x0F, 0xFC,
    0x1F, 0xFE, 0x39, 0x26,
    0x78, 0x07, 0x60, 0x03,
    0x60, 0x03, 0x60, 0x03,
    0x70, 0x03, 0x38, 0x07,
    0x18, 0x06, 0x1C, 0x0E,
    0x0F, 0xFC, 0x07, 0xF8,
};

uint8_t grab_mask[] = {
    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x0F, 0xFC,
    0x1F, 0xFE, 0x3F, 0xFE,
    0x7F, 0xFF, 0x7F, 0xFF,
    0x7F, 0xFF, 0x7F, 0xFF,
    0x7F, 0xFF, 0x3F, 0xFF,
    0x1F, 0xFE, 0x1F, 0xFE,
    0x0F, 0xFC, 0x07, 0xF8,
};

namespace chroma {

    std::unique_ptr<CursorManager> CursorManager::instance = nullptr;

    CursorManager::CursorManager() noexcept {
        cursors.resize(static_cast<size_t>(Cursor::Count), nullptr);

        cursors[(size_t)Cursor::Default] = SDL_CreateCursor(
            arrow_data,
            arrow_mask,
            16,
            16,
            0,
            0
        );

        cursors[(size_t)Cursor::Cross] = SDL_CreateCursor(
            cross_data,
            cross_mask,
            16,
            16,
            8,
            8
        );

        cursors[(size_t)Cursor::Grab] = SDL_CreateCursor(
            grab_data,
            grab_mask,
            16,
            16,
            8,
            8
        );

        for (SDL_Cursor* cursor : cursors) {
            if (cursor == nullptr) {
                SDL_Log("Error: Failed to create cursor: %s\n", SDL_GetError());
            }
        }
    }

    CursorManager::~CursorManager() noexcept {
        for (SDL_Cursor* cursor : cursors) {
            if (cursor) {
                SDL_DestroyCursor(cursor);
            }
        }
    }

    CursorManager& CursorManager::get_instance() noexcept {
        if (!instance) {
            instance = std::unique_ptr<CursorManager>(new CursorManager());
        }
        return *instance;
    }

    void CursorManager::set_cursor(Cursor cursor) noexcept {
        CursorManager &mgr = get_instance();

        size_t index = static_cast<size_t>(cursor);
        if (index >= mgr.cursors.size() || !mgr.cursors[index]) {
            index = static_cast<size_t>(Cursor::Default);
        }

        mgr.cursor = cursor;
    }

    void CursorManager::update() noexcept {
        CursorManager &mgr = get_instance();

        size_t index = static_cast<size_t>(mgr.cursor);
        SDL_SetCursor(mgr.cursors[index]);
    }

} // namespace chroma
